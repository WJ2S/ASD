# PHP
# Test and package your PHP project.
# Add steps that run tests, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/php

trigger:
- main

jobs:
- job: PHPUnit
  displayName: 'Run PHPUnit Tests'
  pool:
    vmImage: 'ubuntu-latest'
  steps:
  - task: UseNode@1
    inputs:
      versionSpec: '10.x'
      checkLatest: true

  - task: UseComposer@2
    inputs:
      version: '2.x'
      checkLatest: true

  - checkout: self

  - script: |
      docker run -v $(Build.Repository.LocalPath):/app -w /app php:7.4-cli-alpine php -v
    displayName: 'Check PHP Version'

  - script: |
      docker run -v $(Build.Repository.LocalPath):/app -w /app php:7.4-cli-alpine composer install
    displayName: 'Install Dependencies'

  - script: |
      docker run -v $(Build.Repository.LocalPath):/app -w /app php:7.4-cli-alpine vendor/bin/phpunit
    displayName: 'Run PHPUnit Tests'